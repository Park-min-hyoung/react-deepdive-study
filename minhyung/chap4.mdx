---
title: 04장 정리
date: "2024/04/24"
description: 서버 사이드 렌더링
---

## 서버 사이드 렌더링이란?

1. 싱글 페이지 애플리케이션 세상

- 싱글 페이지 애플리케이션이란 렌더링과 라우팅에 필요한 대부분의 기능을 서버가 아닌 브라우저의 자바스크립트에 의존하는 방식을 의미한다.

2. 서버 사이드 렌러링이란?

- 최초에 사용자에게 보여줄 페이지를 서버에서 렌더링해 빠르게 사용자에게 화면을 제공하는 방식
- 장점
  - 최초 페이지 진입이 비교적 빠르다.
  - 검색 엔진과 SNS 공유 등 메타데이터 제공이 쉽다.
  - 누적 레이아웃 이동이 적다.
  - 사용자의 디바이스 성능에 비교적 자유롭다.
  - 보안에 좀 더 안전한다.
- 단점
  - 소스코드를 작성할 때 항상 서버를 고려해야 한다.
  - 적절한 서버가 구축돼 있어야 한다.
  - 서비스 지연에 따른 문제

3. SPA와 SSR을 모두 알아야 하는 이유

- 서버 사이드 렌러링 역시 만능이 아니다.
- 싱글 페이지 애플리케이션과 서버 사이드 렌더링 애플리케이션
  - 가장 뛰어난 싱글페이지 애플리케이션은 가장 뛰어난 멀티 페이지 애플리케이션보다 낫다.
  - 평균적인 싱글 페이지 애플리케이션은 평균적인 머티 페이지 애플리케이션보다 느리다.
- 현대의 서버 사이드 렌더링
  - 최초 웹 사이트 진입 시에는 서버 사이드 렌더링 방식으로 서버에서 완성된 HTML을 제공
  - 이후 라우팅에서는 서버에서 내려받은 자바스크립트를 바탕으로 마치 싱글 페이지 애플리케이션처럼 작동

4. 정리

- 다수의 사용자에게 좋은 사용자 경험을 제공할 수 있는 웹 애플리케이션을 만들고 싶은 개발자라면 두 가지 방법을 모두 숙지할 필요가 있다.
- 둘 중 어느 것이 완벽하게 옳다고 말할 수 없으므로 두 가지 모두를 이해하고 필요에 따라 맞는 방법을 사용할 수 있다.

## 서버 사이드 렌더링을 위한 리액트 API 살펴보기

1. renderToString

- 인수로 넘겨받은 리액트 컴포넌트를 렌더링해 HTML 문자열로 반환하는 함수다.
- 최초의 페이지를 HTML로 먼저 렌더링하는 역할을 한다.

2. renderToStaticMarkup

- renderToString 유사한 함수로써 리액트에서만 사용하는 속성이 필요없는 HTML 문자열을 반환하는 함수
- HTML 크기를 아주 약간이라도 줄일 수 있다.

3. renderToNodeStream

- renderToString과 결과물이 완전 동일하다.
- renderToString은 브라우저에서도 실행할 수 있지만 renderToNodeStream은 브라우저에서 사용하는 것이 완전히 불가능하다.(완전히 Node.js 환경에 의존)
- 결과물 타입: renderToString(문자열), renderToNodeStream(Node.js의 ReadableStream)
- 스트림을 활용하면 이러한 큰 크기의 데이터를 청크 단위로 분리해 순차적으로 처리할 수 있다는 장점이 있다.

4. renderToStaticNodeStream

- renderToNodeStream 유사한 함수로(리액트에서만 사용하는 속성이 필요없을 때 사용)

5, hydrate

- renderToString, renderToNodeStream으로 생성된 HTML 콘텐츠에 자바스크립트 핸들러나 이벤트를 붙이는 역할을 한다.
- render와의 차이점은 hydrate는 기본적으로 이미 렌더링된 HTML이 있다는 가정하에 작업이 수행되고, 이 렌더링된 HTML을 기준으로 이벤트를 붙이는 작업만 실행한다.
- 만약 hydrate의 두번째 인수에는 이미 renderToString 등으로 렌더링된 정적인 HTML 정보가 반드시 담겨져 있어야한다.(아무것도 없는 빈 HTML에 이 정보를 렌더링하는 render와 차이점이 있다.)

6. 정리

- 서버 사이드 렌더링을 하기 위한 서버가 있어야 하는데 개발자 입장에서 서버라는 존재 자체가 부담이 된다.
- 서버에서 HTML을 제공하는 것 뿐만 아니라 번들링된 자바스크립트 소스도 제공해야 하며, 적절하게 캐시도 사용해야 하는 등 많은 것들을 고려해야한다.

## Next.js 톺아보기

1. Next.js란?

- 풀스택 웹 애플리케이션을 구축하기 위한 리액트 기반 프레임워크

2. Next.js 시작하기

- package.json: 프로젝트 구동에 필요한 모든 명령어 ㅓ및 의존성이 포함돼 있으므로 프로젝트의 대략적인 모습을 확인하는데 매우 유용하다.
- next.config.js: Next.js 프로젝트의 환경 설정을 담당하며, Next.js를 자유자재로 다루려면 반드시 알아야 하는 파일이다.
- pages/\_app.tsx: 웹 애플리케이션에서 공통으로 설정해야 하는 것들을 여기에서 실행할 수 있따.
  - 에러 바운더리를 사용해 애플리케이션 전역에서 발생하는 에러 처리
  - reset.css 같은 전역 CSS 선언
  - 모든 페이지에 공통으로 사용 또는 제공해야 하는 데이터 제공 등
- pages/\_document.tsx
  - HTML을 초기화하는 곳
  - CSS-in-JS 스타일을 서버에서 모아 HTML로 제공하는 작업을 할 수 있다.
  - \_app.tsx는 Next.js를 초기화 하는 파일로, Next.js 설정과 관련된 코드를 모아두는 곳
  - \_document.tsx는 Next.js로 만드는 웹사이트의 뼈대가 되는 HTML 설정과 관련된 코드를 추가하는 곳(반드시 서버에서만 렌더링된다.)
- pages/\_error.tsx
  - Next.js 프로젝트 전역에서 발생하는 에러를 적절하게 처리하고 싶다면 이 페이지를 활용
- pages/404.tsx
  - 404 페이지를 정의할 수 있는 파일
  - 만들지 않으면 Next.js에서 제공하는 기본 404 페이지를 볼 수 있고, 원하는 스타일의 404 페이지를 이곳에서 만들 수 있다.
- pages/500.tsx
  - 서버에서 발생하는 에러를 핸들링하는 페이지다.
  - \_error.tsx와 500.tsx가 모두 있다면 500.tsx가 우선적으로 실행된다.
- pages/index.tsx
  - 라우팅구조는 /pages 디렉터리를 기초로 구성
  - 각 페이지에 있는 default export로 내보낸 함수가 해당 페이지의 루트 컴포넌트가 된다.

3. Date Fetching

- getStaticPaths
- getStaticProps
- getServerSideProps
- getInitialProps

4. 스타일 적용하기

- 전역 스타일(\_app.tsx 활용): 애플리케이션 전역에 스타일 적용
- 컴포넌트 레벨 CSS: [name].module.css와 같은 명명 규칙만 준수하면 된다.
- SCSS와 SASS
- CSS-in-JS

5. \_app.tsx 응용하기

- \_app.tsx는 Next.js로 만든 모든 서비스가 진입하는 최초 진입점
- 이러한 특성을 활용하여 사용자가 처음 서비스에 접근했을 때 하고 싶은 무언가를 여기에서 처리할 수 있다.
- 웹 서비스를 최초에 접근했을 때만 실행하고 싶은 내용과 관련된 데이터를 가지고 있을 수 있다.

6. next.config.js 살펴보기

- Next.js 실행에 필요한 설정을 추가할 수 있는 파일
- 설정
  - basePath: 기본적으로 애플리케이션을 실행하면 호스트 아래 /에 애플리케이션이 제공될 것이다.
  - swcMinify: swc를 이용해 코드를 압축할지를 나타낸다.
  - poweredByHeader: Next.js는 응답 헤더에 "X-Power-by: Next.js" 정보를 제공하는데, false를 선언하면 이 정보가 사라진다. 기본적으로 보안 관련 솔루션에는 powered-by 헤더를 취약점으로 분류하므로 false로 설정하는 것이 좋다.
  - redirects: 특정 주소를 다른 주소로 보내고 싶을 때 사용. 정규식도 사용 가능하므로 다양한 방식으로 응용할 수 있다.
  - reactStricMode: 리액트에서 제공하는 엄격 모드를 설정할지 여부를 나타낸다. 기본값은 false이지만 true로 설정해 다가올 리액트 업데이트에 미리 대비하는 것을 추천
  - assetPrefix: 만약 Next에서 빌드된 결과물을 동일한 호스트가 아닌 다른 CDN 등에 업로드하고자 한다면 이 옵션에 해당 CDN 주소를 명시하면 된다.

7. 정리

- 리액트에 대해 어느 정도 익숙하고, 실제 서버 사이드 렌더링 기반 애플리케이션을 제작해 보고 싶다면 Next.js 추천
