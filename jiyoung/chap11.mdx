---
title: 11장 정리
date: "2024/06/05"
description: Next.js 13과 React 18
---

## 리액트 서버 컴포넌트

### 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계

- 기존 SSR 의 방식, 서버에서 DOM 을 불러오고 클라이언트는 만들어진 DOM 을 기준으로 하이드레이션을 진행하여 이벤트 핸들러를 DOM 에 추가하고 요청에 따라 응답하는 방식은 한계가 있다.
- 자바스크립트 번들크기가 0인 컴포넌트 생성이 불가능. 타 라이브러리 사용시 서버와 클라이언트 모두 해당 라이브러리를 로딩해야 하는 단점이 발생
- 백엔드 리소스에 직접적 접근이 불가능
- 자동 코드 분할이 불가능. 코드를 여러 단위로 나누어 필요할 때만 동적으로 로딩하는 기능을 리액트에서는 lazy 로 구현이 가능하지만 SSR 에서는 항상 lazy 로 감싸줘야만 하며 동적 판단에 따라 어떤 컴포넌트를 미리 그릴지 판단이 어렵다
- 연쇄적으로 발생하는 클라이언트와 서버의 요청을 대응하기 어렵다.

### 서버 컴포넌트란

- 서버에서 구동이 가능한 컴포넌트를 말한다. **서버에서 만들어서 빠르게 HTML 을 내려주는 SSR 과는 다른 개념이다**

- 서버 컴포넌트 문제점

  - 요청되면 딱 한번 생성되어 전달 되므로 상태 및 생명주기 활용이 불가능
  - 브라우저에서 사용되는 DOM API, window, document 등에 접근이 불가능

- 클라이언트 컴포넌트 문제점

  - 서버 컴포넌트를 불러올 수 없다

- 공용 컴포넌트

  - 위에 기술한 컴포넌트의 문제점을 동시에 가지는 컴포넌트

- 리액트는 기본적으로 모든 컴포넌트를 공용 컴포넌트로 판단하며 "use client" 라고 작성한 컴포넌트만 클라이언트 컴포넌트로 판단

### 서버 컴포넌트는 어떻게 작동하는가

- 서버에서 스트리밍 형태로 페이지 정보를 보낸다. 따라서, 클라이언트는 줄 단위로 JSON 을 읽어서 컴포넌트 렌더링이 가능하여 되도록 빠르게 사용자에게 결과물을 보여줄 수 있다
- 컴포넌트 별로 번들링이 가능하여, 필요에 따라 특정 컴포넌트를 지연하여 받는 등의 처리가 가능하다
- JSON 으로 직렬화 된 데이터를 받아 빠르게 컴포넌트 트리의 구성을 한다. 즉, SSR 이 단순히 HTML 을 그리는 것에 비해 더 고도화된 작업을 빠르게 수행할 수 있다
- 이 모든 내용은 SSR 의 단점을 극복하기 위해서 적용 된 내용이다

### Next.js 에서의 리액트 서버 컴포넌트

- 13 버전에 들어서 서버 컴포넌트 기능이 적용 되었다
- page.js 와 layout.js 는 반드시 서버 컴포넌트로 적용되기 때문에 제약 사항을 반드시 따라야 한다
- 서버 컴포넌트는 클라이언트 컴포넌트를 children props 로 받는 것만 가능한데, page.js 와 layout.js 는 DOM 트리의 최상단에 위치하므로 서버 컴포넌트의 장점만 가질 수 있다.
- 이를 이용하여 page.js 와 layout.js 는 클라이언트에 부담을 주지 않고 서버에서 빠르게 생성이 가능하며 직렬화된 JSON 을 통해 클라이언트에 전달 되므로 빠르게 최초 페이지와 레이아웃을 사용자에게 제공이 가능해진다
- 이렇게 그려진 페이지와 레이아웃에 클라이언트에서 그린 클라이언트 컴포넌트가 얹어지는 개념이므로, 모든 작업을 클라이언트에서 수행하던 것에 비해 효율성과 사용성 제공이 가능해 진다

---

## Next.js에서 서버사이드 렌더링

- 웹사이트들은 자바스크립트, HTML, CSS에 의존하고 서버로부터 데이터를 요청한다.
- 웹페이지의 첫번째 로드는 필수적이므로, SSR은 해당 페이지의 HTML 컨텐츠를 미리 빌드한다.
- 이것은 SEO에 효과적이고, 사용자가 자바스크립트 코드를 다운받는 동안 해당 페이지의 컨텐츠를 볼수 있다. 서버의 결과물은 HTML이다.

- SSR은 클라이언트 컴포넌트의 HTML을 보여줌으로써 사용자가 페이지를 로드할때 초기 부팅시간을 줄여줄수 있도록 한다.
- 그러나, HTML이 로드 됐을때 아직 다운로드를 해야한다면, 컴포넌트들을 파싱해야한다.

## 서버 컴포넌트들과 서버사이드 렌더링의 차이점

- 서버 컴포넌트들은 HTML 자체를 반환하기보다, 렌더된 UI에 대한 설명을 반환한다.
- 이러한 방식은 리액트가 상태값을 잃지 않고 존재하는 클라이언트 컴포넌트들과 데이터를 영리하게 병합하도록 한다.

아래에서 중간 state를 볼 수 있다.

![state](/assets/jiyoung/next.jpeg)

- 브라우저의 stream 은 더이상 JSON이 아니지만, JSON과 비슷한 이미지 처럼 보인다.이것은 리액트 서버 컴포넌트들이 페이지에 컴포넌트들을 렌더하기 위해 다른 stream type을 사용하기 때문이다.

- **리액트 서버 컴포넌트들은 각각의 컴포넌트마다, 클라이언트 컴포넌트로 렌더할 것인지 서버 컴포넌트로 렌더할 것인지 선택하도록 한다.**
- **반면에 서버사이드 렌더링은 페이지당, 해당 페이지 자체를 서버사이드 렌더링을 하도록 한다.**
